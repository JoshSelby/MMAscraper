group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.r1b, .score1, .r2b, .score2))[-1])
ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ .r1b + .r2b, .init=1000)[-1])
ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ .x + .r2b, .init=1000)[-1])
ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ .x + .y, .init=1000)[-1])
ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, .y), .init=1000)[-1])
?elo
ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, score1, .y, score2), .init=1000)[-1])
ncaa2005 <- ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, score1, .y, score2), .init=1000)[-1])
View(ncaa2005)
ncaa2005 <- ncaa2005 %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, .score1, .y, .score2), .init=1000)[-1])
?reduce
1:3 %>% reduce(`+`)
1:3 %>% reduce(`+`, accumulate = T)
ncaa2005 <- as_widecr(ncaa2005)
ncaa2005 <- as_widecr(ncaa2005)
ncaa2005
ncaa <- as_widecr(ncaa2005)
ncaa <- as_widecr(ncaa2005)
elo <- add_elo_ratings(ncaa)
ncaa <- ncaa %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, score1, .y, score2), .init=1000)[-1])
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa[, r1a := 1000, player1]
library(data.table)
ncaa <- ncaa[, r1a := 1000, player1]
ncaa <- ncaa %>%
as.data.table() %>%
ncaa[, r1a := 1000, player1]
ncaa <- ncaa %>%
as.data.table() %>%
ncaa[, r1a := 1000, by=player1]
ncaa <- ncaa %>% as.data.table()
ncaa <- ncaa[, r1a := 1000, player1]
ncaa
ncaa
ncaa
ncaa <- ncaa[, .SD[1], player1]
ncaa
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, score1, .y, score2), .init=1000)[-1])
ncaa <- ncaa %>% as.data.table()
ncaa <- ncaa[, 1000, player1]
ncaa
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
mutate(r1a = accumulate(r1b, ~ elo(.x, score1, .y, score2), .init=1000)[-1])
ncaa <- ncaa %>% as.data.table()
ncaa[, 1000, player1]
ncaa[, r1a := 1000, player1]
ncaa
ncaa[, r1a := 1000, player1]
ncaa[, r1a := 1000L, player1]
ncaa
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup() %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup()
c
ncaa <- ncaa %>% as.data.table()
ncaa[, r1a := 1000L, player1]
ncaa
library(data.table)
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>% as.data.table()
ncaa[, r1a := 1000L, player1]
ncaa
?broom
?map
ncaa %>%
group_by(player1) %>%
mutate(r1a = map(score1, ~ .x))
ncaa %>%
group_by(player1) %>%
mutate(r1a = map_dbl(score1, ~ .x))
ncaa %>%
group_by(player1) %>%
mutate(r1a = map_dbl(score1, ~ .x > score2))
ncaa %>%
group_by(player1) %>%
mutate(r1a = map_dbl(score1, ~ .x > .y))
?map2
ncaa %>%
group_by(player1) %>%
mutate(r1a = map2_dbl(.x = score1, .y = score2, ~ .x > .y))
ncaa %>%
group_by(player1) %>%
mutate(r1a = map2_dbl(.x = score1, .y = score2, ~ elo(.x, .x > .y, .y, .x < .y)))
?elo
ncaa %>%
group_by(player1) %>%
mutate(r1a = map2_dbl(.x = score1, .y = score2, ~ .x + .y))
?map2
ncaa %>%
group_by(player1) %>%
mutate(r1a = map2_dbl(.x = score1, .y = score2, ~ elo(.x, .x > .y, .y, .x < .y)[1]))
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA)
ncaa
delta <- function(x) (x + dplyr::lag(x)) /x
cols <- c("wt", "mpg")
#This
library(dplyr)
mtcars %>% mutate_at(cols, delta)
mtcars
mtcars %>% mutate_at(cols, delta)
2.875+2.62
5.495/2.875
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA)
ncaa
ncaa %>% slice(10)
ncaa %>% slice(sample(10))
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA) %>%
slice(sample(n()))
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA) %>%
slice(sample(n()))
ncaa
ncaa %>%
group_by(player1) %>%
arrange(game)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa %>%
group_by(player1) %>%
arrange(game)
ncaa %>%
group_by(player1
)
ncaa %>%
group_by(player1) %>%
arrange(game)
ncaa %>%
group_by(player1) %>%
arrange(game) %>%
mutate(r1b = ifelse(row_number==1, 1000, NA))
ncaa %>%
group_by(player1) %>%
arrange(game) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
group_by(player1) %>%
arrange(Date) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
group_by(player1) %>%
arrange(game) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
group_by(game, player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup()
elo
return(r1 + K * prob_win1)
eloprob <- function(r1, r2, K=75) {
prob_win1 <- 1/(1 + 10^((r2 - r1)/400))
return(r1 + K * prob_win1)
}
eloprob(1000,1000)
eloprob <- function(r1, r2, K=150) {
prob_win1 <- 1/(1 + 10^((r2 - r1)/400))
return(r1 + K * prob_win1)
}
eloprob(1000,1000)
eloprob(1075,1000)
prob_win1 <- 1/(1 + 10^((r1 - r2)/400))
eloprob <- function(r1, r2, K=150) {
prob_win1 <- 1/(1 + 10^((r1 - r2)/400))
return(r1 + K * prob_win1)
}
eloprob(1075,1000)
ncaa %>%
mutate(r1a = ifelse(score1 > score2, eloprob(r1b, r2b), eloprob(r2b, r1b)))
eloprob <- function(r1, r2, K=150) {
prob_win1 <- 1/(1 + 10^((r1 - r2)/400))
return(r1 + K * prob_win1)
}
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup()
ncaa %>%
mutate(r1a = ifelse(score1 > score2, eloprob(r1b, r2b), eloprob(r2b, r1b)))
eloprob <- function(r1, r2, K=150) {
prob_win1 <- 1/(1 + 10^((r1 - r2)/400))
return(r1 + K * prob_win1)
}
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa <- ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup()
ncaa %>%
mutate(r1a = ifelse(score1 > score2, eloprob(r1b, r2b), eloprob(r2b, r1b)))
eloprob <- function(r1, r2, K=150) {
prob_win <- 1/(1 + 10^((r1 - r2)/400))
return(r1 + K * prob_win, r2 - K * prob_win)
}
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
eloprob(1000,1000)
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
eloprob(1000,1000)
eloprob(1000,1000)[1]
eloprob(1000,1000)[2]
ncaa %>%
mutate(r1a = ifelse(score1 > score2, eloprob(r1b, r2b)[1], eloprob(r1b, r2b)[2]),
r2a = ifelse(score1 > score2, eloprob(r1b, r2b)[2], eloprob(r1b, r2b)[1]))
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
return(c(wrat + K * prob_win, lrat - K * prob_win))
eloprob <- function(wrat, lrat, K=150) {
prob_win <- 1/(1 + 10^((wrat - lrat)/400))
return(c(wrat + K * prob_win, lrat - K * prob_win))
}
eloprob(1000,1000)
eloprob(1050,1000)
eloprob(10750,1000)
eloprob(1075,1000)
elo
eloprob <- function(r1, r2, res, K=150) {
prob_win <- 1/(1 + 10^((r1 - r2)/400))
return(c(r1 + K * (res - prob_win),
r2 - K * (res - prob_win)))
}
eloprob(1000,1000,1)
eloprob(1000,1000,0)
eloprob(1000,1000,0.5)
chres <- function(s1, s2) {
if (s1 > s2) {
return(1)
}
else if (s1 < s2) {
return(0)
}
else {
return(0.5)
}
}
chres(5,4)
chres(5,5)
chres(5,6)
ncaa %>%
mutate(r1a = elo(r1b, r2b, chres(score1, score2)))
elo(1000,1000,chres(75, 45))
ncaa %>%
mutate(r1a = eloprob(r1b, r2b, chres(score1, score2)))
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
View(ncaa)
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
rm(chres)
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10),
res = ifelse(score1>score2, 1, ifelse(score1=score2, 0.5, 0)))
ncaa <- ncaa %>%
mutate(r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10),
res = ifelse(score1 > score2, 1, ifelse(score1 == score2, 0.5, 0)))
library(purrr)
library(dplyr)
library(data.table)
eloprob <- function(r1, r2, res, K=150) {
prob_win <- 1/(1 + 10^((r1 - r2)/400))
return(c(r1 + K * (res - prob_win),
r2 - K * (res - prob_win)))
}
ncaa <- as_widecr(ncaa2005)
ncaa <- ncaa %>%
mutate(res = ifelse(score1 > score2, 1, ifelse(score1 == score2, 0.5, 0)),
r1b = NA,
r2b = NA,
r1a = NA,
r2a = NA,
game = sample(10))
ncaa <- ncaa %>%
arrange(game) %>%
group_by(player1) %>%
mutate(r1b = ifelse(row_number()==1, 1000, NA)) %>%
group_by(player2) %>%
mutate(r2b = ifelse(row_number()==1, 1000, NA)) %>%
ungroup()
ncaa %>%
mutate(r1a = eloprob(r1b, r2b, res)[1])
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
source('~/GitHub/MMAscraper/test.R', echo=TRUE)
eloprob(1000,1000,1)[1]
eloprob(1000,1000,0)[1]
ncaa %>%
mutate(r1a = r1b + r2b)
ncaa %>%
mutate(r1a = r1b + r2b + res)
ncaa %>%
mutate(r1a = eloprob(r1b, r2b, 0))
ncaa %>%
mutate(r1a = eloprob(r1b, r2b, 0)[1])
ncaa %>%
mutate(r1a = ~eloprob(r1b, r2b, 0)[1])
ncaa %>%
mutate(r1a = eloprob(r1b, r2b, 0)[1])
ncaa %>%
mutate(r1a = eloprob(r1b, r2b, res)[1])
eloprob(45,23)
eloprob(45,23, 1)
add_elo_ratings(ncaa)
add_elo_ratings(ncaa, 1000)
?add_elo_ratings
add_elo_ratings(ncaa, initial_ratings = 1000)
add_elo_ratings(ncaa, K = 150, initial_ratings = 1000)
rate_elo(ncaa)
rate_elo(ncaa2005)
ncaa2005
rate_elo(ncaa2005)
rate_elo(ncaa)
rate_elo(ncaa2005)
add_elo_ratings(ncaa, K = 150, initial_ratings = 1000)
