select(match_id, Fighter1, Result, Fighter2, Date, record1, record2, rating1Before, rating2Before, rating1After, rating2After, sum, diff) %>%
select(sum) %>% summary
library(tidyverse)
library(zoo)
fights <- readRDS(file = "./ratings-4/fightsElo.rds")
fights1 <- fights
fights2 <- fights %>%
mutate(Result = ifelse(Result=="win", "loss", Result))
colnames(fights2) <- fights2 %>%
colnames %>%
gsub(1,3,.) %>%
gsub(2,1,.) %>%
gsub(3,2,.)
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
library(data.table)
profvis(expr = {
fights <- readRDS(file = "./ratings-4/fightsElo.rds")
fights1 <- fights
fights2 <- fights %>%
mutate(Result = ifelse(Result=="win", "loss", Result))
colnames(fights2) <- fights2 %>%
colnames %>%
gsub(1,3,.) %>%
gsub(2,1,.) %>%
gsub(3,2,.)
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
})
library(profvis)
profvis(expr = {
fights <- readRDS(file = "./ratings-4/fightsElo.rds")
fights1 <- fights
fights2 <- fights %>%
mutate(Result = ifelse(Result=="win", "loss", Result))
colnames(fights2) <- fights2 %>%
colnames %>%
gsub(1,3,.) %>%
gsub(2,1,.) %>%
gsub(3,2,.)
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
})
?full_join
profvis(expr = {
fights3 <- fights3 %>% group_by(Link1) %>%
mutate(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = lag(rollapply(r2b, 3, mean, align='right', fill=NA),1)
)
})
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
class(fights3)
profvis(expr = {
fights3 %>% setkey(Link1)
})
profvis(expr = {
fights3 %>% setkey(Link1)
fights3[,ratIncrease1 := r1b - lag(r1b)]
})
View(fights3)
fights3[grepl("Chael-Sonnen", Link1)]
fights3[grepl("Chael-Sonnen", Link1)] %>% View()
profvis(expr = {
fights3 %>% setkey(Link1)
fights3[, ':='(ratIncrease1 = r1b - lag(r1b))]
})
View(fights3)
View(fights3)
fights3[grepl("Georgi-Bedoev", Link1)]
fights3[grepl("Georgi-Bedoev", Link1)] %>% View()
fights3 %>% setkey(Link1)
fights3[, ':='(ratIncrease1 = r1b - lag(r1b))]
fights3[grepl("Georgi-Bedoev", Link1)] %>% View()
profvis(expr = {
fights3 %>% setkey(Link1)
fights3[, ratIncrease1 := r1b - lag(r1b)]
})
fights3[grepl("Georgi-Bedoev", Link1)] %>% View()
fights3[grepl("Chael-Sonnen", Link1)] %>% View()
profvis(expr = {
fights3 %>% setkey(Link1)
fights3[, ratIncrease1 := lag(r1b)]
})
fights3[grepl("Chael-Sonnen", Link1)] %>% View()
fights3[grepl("Georgi-Bedoev", Link1)] %>% View()
fights3 %>% setkey(Link1)
fights3[, ratIncrease1 := shift(r1b)]
fights3[grepl("Georgi-Bedoev", Link1)] %>% View()
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
fights3 %>% setkey(Link1)
fights3[, ratIncrease1 := shift(r1b)]
View(fights3)
fights3 %>% setkey(Link1)
fights3[, ratIncrease1 := shift(r1b), by=Link1]
View(fights3)
fights3 %>% setkey(Link1)
profvis(expr = {
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - shift(r1b),
ratIncrease1_3 = r1b - shift(r1b, 3),
oppRat1_3 = lag(rollapply(r2b, 3, mean, align='right', fill=NA))),
by=Link1]
})
View(fights3)
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - shift(r1b),
ratIncrease1_3 = r1b - shift(r1b, 3),
oppRat1_3 = lag(rollapply(r2b, 3, mean, align='right', fill=NA))),
by=Link1]
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b, 3),
oppRat1_3 = lag(rollapply(r2b, 3, mean, align='right', fill=NA))),
by=Link1]
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - lag(Date)),
by=Link1]
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - shift(Date)),
by=Link1]
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b, 3)),
by=Link1]
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b, 3),
oppRat1_3 = lag(rollapply(r2b, 3, mean, align='right', fill=NA),1)),
by=Link1]
?rollmeanr
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b, 3),
oppRat1_3 = rollmeanr(r2b, 3)),
by=Link1]
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
fights3 %>% setkey(Link1)
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b, 3),
oppRat1_3 = rollmeanr(r2b, 3)),
by=Link1]
rollmeanr(1:10)
rollmeanr(1:10, 3)
rollmeanr(c(1:25)**2, 3)
1:25 - lag(1:25, 3)
rollmeanr(c(1:25)**2, 3, na.pad = T)
fights3[, ':='(fightLag1 = Date - shift(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b, 3),
oppRat1_3 = rollmeanr(r2b, 3, na.pad = T)),
by=Link1]
View(fights3)
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
fights3 %>% setkey(Link1)
fights3[, ':='( oppRat1_3 = rollmeanr(r2b, 3, na.pad = T)),
by=Link1]
fights3[, ':='(oppRat1_3 = rollmean(r2b, 3, na.pad = T, align = "right")),
by=Link1]
rollmean(1:25, 3, na.pad = T, align = "right")
fights3[, ':='(oppRat1_3 = rollmean(r2b, 3, na.pad = T, align = "right")),
by=Link1]
fights3[, oppRat1_3 := rollmean(r2b, 3, na.pad = T, align = "right"),
by=Link1]
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
fights3[, oppRat1_3 := rollmean(r2b, 3, na.pad = T, align = "right"),
by=Link1]
View(fights3)
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 %>% setkey(Link1)
fights3[, oppRat1_3 := rollmean(r2b, 3, na.pad = T, align = "right"),
by=Link1]
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
A <- iris
setDT(A)
A[,stdev := rollapply(Petal.Width, width=2, sd, align='right', partial=F, fill=NA), by=Species]
A
# Create new metrics
fights3[, oppRat1_3 := rollmean(r2b, 3, na.pad = T, align = "right"),
by=Link1]
# Create new metrics
fights3[, oppRat1_3 := rollmeanr(r2b, 3, fill=NA),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
# Create new metrics
fights3[, oppRat1_3 := rollmeanr(match_id, 3, fill=NA),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
rollmeanr(r2b, 3, fill=NA)),
by=Link1]
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r2b, 3, fill=NA)),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r2b, 3, fill=NA)),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
A[,stdev := rollmeanr(Petal.Width, width=2, fill=NA), by=Species]
A[,stdev := rollmeanr(Petal.Width, k=3, fill=NA), by=Species]
A
class(fights3)
class(A)
A <- iris
setDT(A)
A
class(1:10)
as.numeric(1:10)
as.numeric(1:10) %>% class
rollmeanr(as.numeric(1:10), 3)
rollmeanr(as.numeric(1:10), 3, fill = NA)
rollmeanr(as.numeric(1:10), 3, fill = NA) %>% class()
rollmeanr(1:10, 3, fill = NA) %>% class()
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr("r2b", 3, fill=NA)),
by=Link1]
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r1b, 3, fill=NA)),
by=Link1]
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r2b, 1, fill=NA)),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
# Create new metrics
fights3[, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r2b, 2, fill=NA)),
by=Link1]
iris %>% View
iris[50:]
iris[50:,]
iris[50:10000,]
iris[50:150,]
A <- iris[50:150,]
setDT(A)
A[,stdev := rollmeanr(Petal.Width, k=3, fill=NA), by=Species]
fights3[fights3[, .I[.N > 50], Link1]]
fights3[fights3[, .I[.N > 50], Link1]$V1]
fights3[fights3[, .I[.N > 50], Link1]$V1] %>% View
fights3[, .I[.N > 50], Link1]$V1
fights3[, .I[.N > 50], Link1]
fights3[fights3[, .I[.N > 50], Link1]$V1] %>% View
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
# Create new metrics
fights3[fights3[, .I[.N > 50], Link1]$V1, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r2b, 3, fill=NA)),
by=Link1]
# Create new metrics
fights3[fights3[, .I[.N > 3], Link1]$V1, ':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = rollmeanr(r2b, 3, fill=NA)),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
fights3[fights3[, .I[.N > 3], Link2]$V1,
':='(fightLag2 = Date - lag(Date),
ratIncrease2 = r2b - lag(r2b),
ratIncrease2_3 = r2b - lag(r2b,3),
oppRat2_3 = lag(rollmeanr(r1b, 3, fill=NA))
),
by=Link1]
fights3[fights3[, .I[.N > 3], Link2]$V1,
':='(fightLag2 = Date - lag(Date),
ratIncrease2 = r2b - lag(r2b),
ratIncrease2_3 = r2b - lag(r2b,3),
oppRat2_3 = lag(rollmeanr(r1b, 3, fill=NA))
),
by=Link2]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
# Create new metrics
fights3[fights3[, .I[.N > 3], Link1]$V1,
':='(fightLag1 = Date - lag(Date),
ratIncrease1 = r1b - lag(r1b),
ratIncrease1_3 = r1b - lag(r1b,3),
oppRat1_3 = lag(rollmeanr(r2b, 3, fill=NA))
),
by=Link1]
# Check with Khabib fights
fights3 %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
filter(grepl("Khabib-Nur", Link1)) %>%
View()
View(fights)
khabib <- fights3 %>% filter(grepl("Khabib-Nur", Link1))
khabib
khabib[,koLosses1 := count()]
khabib[,koLosses1 := .N]
khabib[,koLosses1 := .N, by=Link1]
khabib[,koLosses1 = .N, by=Link1]
class(khabib)
class(fights3)
khabib <- fights3[grepl("Khabib-Nur", Link1)]
khabib[,koLosses1 = .N, by=Link1]
khabib %>% class
khabib[,koLosses1 := .N, by=Link1]
View(khabib)
khabib[,koLosses1 := .I, by=Link1]
View(khabib)
"TKO" == "TKO"
"TKO" == "TKO|KO"
khabib[,koLosses1 := cumsum(Method=="TKO"|Method=="KO"), by=Link1]
View(khabib)
khabib[,koLosses1 := cumsum(Result == "Loss" & (Method=="TKO"|Method=="KO")), by=Link1]
View(khabib)
# Create new metrics
fights3[fights3[, .I[.N > 3], Link1]$V1,
':='(fightLag1 = Date - lag(Date), # Days since last fight
ratIncrease1 = r1b - lag(r1b), # Rating increase since last fight
ratIncrease1_3 = r1b - lag(r1b,3), # Rating increase from 3 fights ago
oppRat1_3 = lag(rollmeanr(r2b, 3, fill=NA)), # Average rating of last 3 opponents
koLosses1 = lag(cumsum(Result == "Loss" &
(Method=="TKO"|Method=="KO"))) # number of KO losses
),
by=Link1]
fights3 <- full_join(fights1, fights2) %>%
arrange(match_id) %>%
as.data.table()
# Create new metrics
fights3[fights3[, .I[.N > 3], Link1]$V1,
':='(fightLag1 = Date - lag(Date), # Days since last fight
ratIncrease1 = r1b - lag(r1b), # Rating increase since last fight
ratIncrease1_3 = r1b - lag(r1b,3), # Rating increase from 3 fights ago
oppRat1_3 = lag(rollmeanr(r2b, 3, fill=NA)), # Average rating of last 3 opponents
koLosses1 = lag(cumsum(Result == "Loss" &
(Method=="TKO"|Method=="KO"))) # number of KO losses
),
by=Link1]
fights3[fights3[, .I[.N > 3], Link2]$V1,
':='(fightLag2 = Date - lag(Date),
ratIncrease2 = r2b - lag(r2b),
ratIncrease2_3 = r2b - lag(r2b,3),
oppRat2_3 = lag(rollmeanr(r1b, 3, fill=NA)),
koLosses2 = lag(cumsum(Result == "Win" &
(Method=="TKO"|Method=="KO")))
),
by=Link2]
# Check with Khabib fights
khabib <- fights3[grepl("Khabib-Nur", Link1)]
khabib %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
View()
# Check with Khabib fights
khabib <- fights3[grepl("Allistair-Ove", Link1)]
# Check with Khabib fights
reem <- fights3[grepl("Allistair-Ove", Link1)]
khabib %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
View()
reem %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
View()
# Check with Khabib fights
reem <- fights3[grepl("Alistair-Ove", Link1)]
reem %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
View()
rm(khabib)
View(fights)
fights3[fights3[, .I[.N > 3], Link1]$V1,
':='(fightLag1 = Date - lag(Date), # Days since last fight
ratIncrease1 = r1b - lag(r1b), # Rating increase since last fight
ratIncrease1_3 = r1b - lag(r1b,3), # Rating increase from 3 fights ago
oppRat1_3 = lag(rollmeanr(r2b, 3, fill=NA)), # Average rating of last 3 opponents
koLosses1 = lag(cumsum(Result == "loss" &
(Method=="TKO"|Method=="KO"))) # number of KO losses
),
by=Link1]
fights3[fights3[, .I[.N > 3], Link2]$V1,
':='(fightLag2 = Date - lag(Date),
ratIncrease2 = r2b - lag(r2b),
ratIncrease2_3 = r2b - lag(r2b,3),
oppRat2_3 = lag(rollmeanr(r1b, 3, fill=NA)),
koLosses2 = lag(cumsum(Result == "win" &
(Method=="TKO"|Method=="KO")))
),
by=Link2]
# Check with Khabib fights
reem <- fights3[grepl("Alistair-Ove", Link1)]
reem %>%
select(-Method, -Method_d, -Event, -Fighter1, -Fighter2, -R, -Time, -Referee,
-wins1, -wins2, -loss1, -loss2, -draw1, -draw2, -nc1, -nc2) %>%
View()
