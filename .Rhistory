source('~/GitHub/MMAscraper/scripts/8-append-odds/matchOdds-filtfights.R', echo=TRUE)
source('./model-6/model.R', echo=TRUE)
source('./scripts/6-model/model.R', echo=TRUE)
filtfightsOdds <- readRDS(file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds2 <- filtfightsOdds %>%
filter(Result != "draw" & r1b > r2b|
(r1b == r2b & ratIncrease1_3 > ratIncrease2_3)) %>%
mutate(eloWinProb = 1/(1+10^((r2b-r1b)/400)),
Result2 = ifelse(Result == "win", 1, 0))
set.seed(1)
train <- filtfightsOdds2 %>%
sample_n(0.8*nrow(filtfightsOdds2)) %>%
select(-Method, -Method_d, -Event, -Date, -r1a, -r2a, -Fighter1, -Fighter2, -R,
-Time, -Referee, -nc1, -nc2)
test <- anti_join(filtfightsOdds2, train)
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + fightLag1 + fightLag2 + fightLag1_5 + fightLag2_5 +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
filtfightsOdds2$pred <- predict(model,newdata=filtfightsOdds2,type='response')
View(filtfightsOdds2)
source('~/GitHub/MMAscraper/./scripts/8-append-odds/matchOdds-filtfights.R', echo=TRUE)
filtfights %>% select(rowid)
library(data.table)
library(tidyverse)
library(stringr)
library(stringdist)
filtfights %>% select(rowid)
source('~/GitHub/MMAscraper/./scripts/8-append-odds/matchOdds-filtfights.R', echo=TRUE)
source('~/GitHub/MMAscraper/./scripts/8-append-odds/matchOdds-filtfights.R', echo=TRUE)
filtfights %>% select(rownum)
filtfights %>% class
filtfightsOdds %>% select(-rownum)
source('~/GitHub/MMAscraper/./scripts/8-append-odds/matchOdds-filtfights.R', echo=TRUE)
filtfightsOdds <- readRDS(file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds2 <- filtfightsOdds %>%
filter(Result != "draw" & r1b > r2b|
(r1b == r2b & ratIncrease1_3 > ratIncrease2_3)) %>%
mutate(eloWinProb = 1/(1+10^((r2b-r1b)/400)),
Result2 = ifelse(Result == "win", 1, 0))
set.seed(1)
train <- filtfightsOdds2 %>%
sample_n(0.8*nrow(filtfightsOdds2)) %>%
select(-Method, -Method_d, -Event, -Date, -r1a, -r2a, -Fighter1, -Fighter2, -R,
-Time, -Referee, -nc1, -nc2)
test <- anti_join(filtfightsOdds2, train)
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + fightLag1 + fightLag2 + fightLag1_5 + fightLag2_5 +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
filtfightsOdds2$pred <- predict(model,newdata=filtfightsOdds2,type='response')
View(filtfightsOdds2)
filtfightsOdds2 %>% filter(Date > "2018-12-10")
filtfightsOdds2 %>% filter(Date > "2018-12-10") %>% View()
filtfightsOdds <- readRDS(file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds2 <- filtfightsOdds %>%
filter(Result != "draw" & r1b > r2b|
(r1b == r2b & ratIncrease1_3 > ratIncrease2_3)) %>%
mutate(eloWinProb = 1/(1+10^((r2b-r1b)/400)),
Result2 = ifelse(Result == "win", 1, 0))
set.seed(1)
train <- filtfightsOdds2 %>%
sample_n(0.8*nrow(filtfightsOdds2)) %>%
select(-Method, -Method_d, -Event, -Date, -r1a, -r2a, -Fighter1, -Fighter2, -R,
-Time, -Referee, -nc1, -nc2)
test <- anti_join(filtfightsOdds2, train)
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + Age1 + Age2 + fightLag1 + fightLag2 + fightLag1_5 + fightLag2_5 +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
filtfightsOdds2$pred <- predict(model,newdata=filtfightsOdds2,type='response')
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + Age1 + Age2 +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
filtfightsOdds2$pred <- predict(model,newdata=filtfightsOdds2,type='response')
View(filtfightsOdds2)
filtfightsOdds2 %>% filter(Date >= "2018-12-10") %>% View()
table("predicted" = fitted.results, "actual" = test$Result2)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
table(filtfightsOdds2$pred>0.5)
table(filtfightsOdds2$pred>0.5, filtfightsOdds2$Result2)
margin.table(filtfightsOdds2$pred>0.5, filtfightsOdds2$Result2)
?table
table(filtfightsOdds2$pred>0.5, filtfightsOdds2$Result2)
table(filtfightsOdds2$pred>0.5, filtfightsOdds2$Result2) %>% sum
(2592+834)/5454
table(filtfightsOdds2$Result2) %>% sum
table(filtfightsOdds2$Result2)
3406/5720
table(filtfightsOdds2$pred>0.5, filtfightsOdds2$Result2) %>% sum
table(filtfightsOdds2$pred>0.5, filtfightsOdds2$Result2)
summary(model)
summary(model)
filtfightsOdds2 %>% filter(Date >= "2018-01-01") %>% View()
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + (Age1 - Age2) +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + (Age1) +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + (Age1 / Age2) +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
model <- glm(Result2 ~ (r1b - r2b) + (wins1 - wins2) + (Age1 - Age2) +
(oppRat1_5 - oppRat2_5) + (koLosses1 - koLosses2),
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
glm
?glm
train
train <- train %>% mutate(ratingdiff = r1b - r2b, windiff = wins1 - wins2, agediff = Age1 - Age2, oppRat5diff = oppRat1_5 - oppRat2_5, koLossdiff = koLosses1 - koLosses2)
train
model <- glm(Result2 ~ ratingdiff, windiff, agediff, oppRat5diff, koLossdiff,
family = binomial(link="logit"), data = train)
model <- glm(Result2 ~ ratingdiff + windiff + agediff + oppRat5diff + koLossdiff,
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
source('~/GitHub/MMAscraper/./scripts/6-model/model.R', echo=TRUE)
filtfightsOdds2 %>% filter(Date >= "2018-01-01") %>% View()
filtfightsOdds <- readRDS(file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds <- readRDS(file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds2 <- filtfightsOdds %>%
filter(Result != "draw" & r1b > r2b|
(r1b == r2b & ratIncrease1_3 > ratIncrease2_3)) %>%
mutate(eloWinProb = 1/(1+10^((r2b-r1b)/400)),
Result2 = ifelse(Result == "win", 1, 0))
View(filtfightsOdds)
?left_join
library(data.table)
library(tidyverse)
library(stringr)
library(stringdist)
pastOdds <- readRDS("./scripts/7-scrape-odds/data/pastOdds.RDS")
futureOdds <- readRDS("./scripts/7-scrape-odds/data/futureOdds.RDS")
filtfights <- readRDS(file = "./scripts/5-metrics/data/filtfights.rds")
# Events with duplicate links
dupedEvents <- pastOdds %>%
group_by(eventName, eventLink, Date) %>%
summarise(num = n()) %>%
group_by(eventName, Date) %>%
summarise(num = n()) %>%
filter(num > 1) %>%
pull(eventName)
# Find the link that is incorrect
wrongEvents <- c()
for (i in 1:length(dupedEvents)) {
wrongEvents[i] <- sapply(pastOdds %>%
filter(eventName == dupedEvents[i]) %>%
pull(eventLink) %>%
unique(), function(x) stringdist(dupedEvents[i], x)) %>%
which.max() %>%
names()
}
# delete
pastOdds <- pastOdds %>%
filter(!(eventLink %in% wrongEvents))
rm(wrongEvents, dupedEvents, i)
# Fix a few fighter's names, create stripped version of name
pastOdds <- pastOdds %>%
mutate(fighter = ifelse(fighter == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", fighter),
opponent = ifelse(opponent == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", opponent),
fighter = ifelse(fighter == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", fighter),
opponent = ifelse(opponent == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", opponent),
fighter = ifelse(fighter == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", fighter),
opponent = ifelse(opponent == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", opponent),
fighterLink1s = gsub("(.*)(-\\d*$)", "\\1", fighter) %>% gsub("-", "", .) %>% tolower(),
fighterLink2s = gsub("(.*)(-\\d*$)", "\\1", opponent) %>% gsub("-", "", .) %>% tolower(),
rownum = row_number(),
eventName = gsub(": ", " - ", eventName)) %>%
filter(!(fighter == "Al-Iaquinta-3221" & opponent == "Paul-Felder-5116") &
!(fighter == "Paul-Felder-5116" & opponent == "Al-Iaquinta-3221") &
!(fighter == "John-Howard-692" & opponent == "Shamil-Gamzatov-6071") &
!(fighter == "Shamil-Gamzatov-6071" & opponent == "John-Howard-692") &
Date >= "2010-01-01") # Since filtfights is also filtered from 2010
filtfights <- filtfights %>%
mutate(fighter1Name = gsub("(.*)(-\\d*$)", "\\1", Link1) %>% gsub("-", "", .) %>% tolower(),
fighter2Name = gsub("(.*)(-\\d*$)", "\\1", Link2) %>% gsub("-", "", .) %>% tolower())
# Begin Matching
filtfightsOdds <- tibble()
for (i in 0:2) {
pastOdds <- pastOdds %>%
mutate(Date2 = Date - i + 1)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter1Name" = "fighterLink1s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter2Name" = "fighterLink2s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds) %>%
unique
}
# Fights which are still not matched
filtfightsNotMatched <- anti_join(filtfights, filtfightsOdds, by = "match_id")
pastOddsNotMatched <- anti_join(pastOdds, filtfightsOdds, by = "rownum")
filtfightsOdds <- filtfightsOdds %>% select(-rownum)
View(filtfightsOdds)
library(data.table)
library(tidyverse)
library(stringr)
library(stringdist)
pastOdds <- readRDS("./scripts/7-scrape-odds/data/pastOdds.RDS")
futureOdds <- readRDS("./scripts/7-scrape-odds/data/futureOdds.RDS")
filtfights <- readRDS(file = "./scripts/5-metrics/data/filtfights.rds")
# Events with duplicate links
dupedEvents <- pastOdds %>%
group_by(eventName, eventLink, Date) %>%
summarise(num = n()) %>%
group_by(eventName, Date) %>%
summarise(num = n()) %>%
filter(num > 1) %>%
pull(eventName)
# Find the link that is incorrect
wrongEvents <- c()
for (i in 1:length(dupedEvents)) {
wrongEvents[i] <- sapply(pastOdds %>%
filter(eventName == dupedEvents[i]) %>%
pull(eventLink) %>%
unique(), function(x) stringdist(dupedEvents[i], x)) %>%
which.max() %>%
names()
}
# delete
pastOdds <- pastOdds %>%
filter(!(eventLink %in% wrongEvents))
rm(wrongEvents, dupedEvents, i)
# Fix a few fighter's names, create stripped version of name
pastOdds <- pastOdds %>%
mutate(fighter = ifelse(fighter == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", fighter),
opponent = ifelse(opponent == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", opponent),
fighter = ifelse(fighter == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", fighter),
opponent = ifelse(opponent == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", opponent),
fighter = ifelse(fighter == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", fighter),
opponent = ifelse(opponent == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", opponent),
fighterLink1s = gsub("(.*)(-\\d*$)", "\\1", fighter) %>% gsub("-", "", .) %>% tolower(),
fighterLink2s = gsub("(.*)(-\\d*$)", "\\1", opponent) %>% gsub("-", "", .) %>% tolower(),
rownum = row_number(),
eventName = gsub(": ", " - ", eventName)) %>%
filter(!(fighter == "Al-Iaquinta-3221" & opponent == "Paul-Felder-5116") &
!(fighter == "Paul-Felder-5116" & opponent == "Al-Iaquinta-3221") &
!(fighter == "John-Howard-692" & opponent == "Shamil-Gamzatov-6071") &
!(fighter == "Shamil-Gamzatov-6071" & opponent == "John-Howard-692") &
Date >= "2010-01-01") # Since filtfights is also filtered from 2010
filtfights <- filtfights %>%
mutate(fighter1Name = gsub("(.*)(-\\d*$)", "\\1", Link1) %>% gsub("-", "", .) %>% tolower(),
fighter2Name = gsub("(.*)(-\\d*$)", "\\1", Link2) %>% gsub("-", "", .) %>% tolower())
# Begin Matching
filtfightsOdds <- tibble()
for (i in 0:2) {
pastOdds <- pastOdds %>%
mutate(Date2 = Date - i + 1)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter1Name" = "fighterLink1s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter2Name" = "fighterLink2s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds) %>%
unique
}
# Fights which are still not matched
filtfightsNotMatched <- anti_join(filtfights, filtfightsOdds, by = "match_id")
pastOddsNotMatched <- anti_join(pastOdds, filtfightsOdds, by = "rownum")
filtfightsOdds <- filtfightsOdds %>% select(-rownum)
View(filtfightsOdds)
?rename()
filtfightsOdds <- filtfightsOdds %>%
select(-rownum) %>%
rename(`5Dimes` = `5Dimes1`)
source('~/GitHub/MMAscraper/./scripts/8-append-odds/matchOdds-filtfights.R', echo=TRUE)
filtfightsOdds <- filtfightsOdds %>%
select(-rownum) %>%
rename(`5Dimes1` = `5Dimes`)
View(filtfightsOdds)
test <- filtfights[1:2,]
left_join(test, test, by = c("Link1" = "Link2", "match_id" = "match_id"))
left_join(test, test, by = c("Link1" = "Link2", "match_id" = "match_id")) %>% select(colnames(test))
left_join(test, test, by = c("Link1" = "Link2", "match_id" = "match_id")) %>% as.tibble %>% select(colnames(test))
left_join(test, test, by = c("Link1" = "Link2", "match_id" = "match_id")) %>% as.tibble %>% class
colnames(test)
left_join(test, test, by = c("Link1" = "Link2", "match_id" = "match_id")) %>% as.tibble %>% select(colnames(test))
left_join(test, test, by = c("Link1" = "Link2", "match_id" = "match_id")) %>% as.tibble
left_join(test, test %>% select(match_id, Link2, odds5Dimes2), by = c("Link1" = "Link2", "match_id" = "match_id")) %>% as.tibble
left_join(test, test %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id")) %>% as.tibble
left_join(test, test %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
filtfightsOdds <- filtfightsOdds %>%
select(-rownum) %>%
rename(`odds5Dimes1` = `5Dimes`) %>%
left_join(. %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
library(data.table)
library(tidyverse)
library(stringr)
library(stringdist)
pastOdds <- readRDS("./scripts/7-scrape-odds/data/pastOdds.RDS")
futureOdds <- readRDS("./scripts/7-scrape-odds/data/futureOdds.RDS")
filtfights <- readRDS(file = "./scripts/5-metrics/data/filtfights.rds")
# Events with duplicate links
dupedEvents <- pastOdds %>%
group_by(eventName, eventLink, Date) %>%
summarise(num = n()) %>%
group_by(eventName, Date) %>%
summarise(num = n()) %>%
filter(num > 1) %>%
pull(eventName)
# Find the link that is incorrect
wrongEvents <- c()
for (i in 1:length(dupedEvents)) {
wrongEvents[i] <- sapply(pastOdds %>%
filter(eventName == dupedEvents[i]) %>%
pull(eventLink) %>%
unique(), function(x) stringdist(dupedEvents[i], x)) %>%
which.max() %>%
names()
}
# delete
pastOdds <- pastOdds %>%
filter(!(eventLink %in% wrongEvents))
rm(wrongEvents, dupedEvents, i)
# Fix a few fighter's names, create stripped version of name
pastOdds <- pastOdds %>%
mutate(fighter = ifelse(fighter == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", fighter),
opponent = ifelse(opponent == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", opponent),
fighter = ifelse(fighter == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", fighter),
opponent = ifelse(opponent == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", opponent),
fighter = ifelse(fighter == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", fighter),
opponent = ifelse(opponent == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", opponent),
fighterLink1s = gsub("(.*)(-\\d*$)", "\\1", fighter) %>% gsub("-", "", .) %>% tolower(),
fighterLink2s = gsub("(.*)(-\\d*$)", "\\1", opponent) %>% gsub("-", "", .) %>% tolower(),
rownum = row_number(),
eventName = gsub(": ", " - ", eventName)) %>%
filter(!(fighter == "Al-Iaquinta-3221" & opponent == "Paul-Felder-5116") &
!(fighter == "Paul-Felder-5116" & opponent == "Al-Iaquinta-3221") &
!(fighter == "John-Howard-692" & opponent == "Shamil-Gamzatov-6071") &
!(fighter == "Shamil-Gamzatov-6071" & opponent == "John-Howard-692") &
Date >= "2010-01-01") # Since filtfights is also filtered from 2010
filtfights <- filtfights %>%
mutate(fighter1Name = gsub("(.*)(-\\d*$)", "\\1", Link1) %>% gsub("-", "", .) %>% tolower(),
fighter2Name = gsub("(.*)(-\\d*$)", "\\1", Link2) %>% gsub("-", "", .) %>% tolower())
# Begin Matching
filtfightsOdds <- tibble()
for (i in 0:2) {
pastOdds <- pastOdds %>%
mutate(Date2 = Date - i + 1)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter1Name" = "fighterLink1s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter2Name" = "fighterLink2s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds) %>%
unique
}
# Fights which are still not matched
filtfightsNotMatched <- anti_join(filtfights, filtfightsOdds, by = "match_id")
pastOddsNotMatched <- anti_join(pastOdds, filtfightsOdds, by = "rownum")
filtfightsOdds <- filtfightsOdds %>%
select(-rownum) %>%
rename(`odds5Dimes1` = `5Dimes`) %>%
left_join(. %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
rm(test)
filtfightsOdds <- filtfightsOdds %>%
left_join(. %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
filtfightsOdds <- filtfightsOdds %>%
left_join(., . %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
filtfightsOdds %>%
left_join(., . %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
left_join(filtfightsOdds, filtfightsOdds %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
filtfightsOdds <- filtfightsOdds %>%
select(-rownum) %>%
rename(odds5Dimes1 = `5Dimes`)
filtfightsOdds <- filtfightsOdds %>%
left_join(., . %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
filtfightsOdds <- filtfightsOdds %>%
left_join(., . %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
left_join(filtfightsOdds, filtfightsOdds %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
filtfightsOdds <- left_join(filtfightsOdds, filtfightsOdds %>% select(match_id, Link2, odds5Dimes1), by = c("Link1" = "Link2", "match_id" = "match_id"))
library(data.table)
library(tidyverse)
library(stringr)
library(stringdist)
pastOdds <- readRDS("./scripts/7-scrape-odds/data/pastOdds.RDS")
futureOdds <- readRDS("./scripts/7-scrape-odds/data/futureOdds.RDS")
filtfights <- readRDS(file = "./scripts/5-metrics/data/filtfights.rds")
# Events with duplicate links
dupedEvents <- pastOdds %>%
group_by(eventName, eventLink, Date) %>%
summarise(num = n()) %>%
group_by(eventName, Date) %>%
summarise(num = n()) %>%
filter(num > 1) %>%
pull(eventName)
# Find the link that is incorrect
wrongEvents <- c()
for (i in 1:length(dupedEvents)) {
wrongEvents[i] <- sapply(pastOdds %>%
filter(eventName == dupedEvents[i]) %>%
pull(eventLink) %>%
unique(), function(x) stringdist(dupedEvents[i], x)) %>%
which.max() %>%
names()
}
# delete
pastOdds <- pastOdds %>%
filter(!(eventLink %in% wrongEvents))
rm(wrongEvents, dupedEvents, i)
# Fix a few fighter's names, create stripped version of name
pastOdds <- pastOdds %>%
mutate(fighter = ifelse(fighter == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", fighter),
opponent = ifelse(opponent == "Jacob-Volkman-1246", "Jacob-Volkmann-3471", opponent),
fighter = ifelse(fighter == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", fighter),
opponent = ifelse(opponent == "Luigi-Vandramini-8636", "Luigi-Vendramini-8636", opponent),
fighter = ifelse(fighter == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", fighter),
opponent = ifelse(opponent == "Elizeu-Zaleski-5594", "Elizeu-Zaleski-Dos-Santos-6667", opponent),
fighterLink1s = gsub("(.*)(-\\d*$)", "\\1", fighter) %>% gsub("-", "", .) %>% tolower(),
fighterLink2s = gsub("(.*)(-\\d*$)", "\\1", opponent) %>% gsub("-", "", .) %>% tolower(),
rownum = row_number(),
eventName = gsub(": ", " - ", eventName)) %>%
filter(!(fighter == "Al-Iaquinta-3221" & opponent == "Paul-Felder-5116") &
!(fighter == "Paul-Felder-5116" & opponent == "Al-Iaquinta-3221") &
!(fighter == "John-Howard-692" & opponent == "Shamil-Gamzatov-6071") &
!(fighter == "Shamil-Gamzatov-6071" & opponent == "John-Howard-692") &
Date >= "2010-01-01") # Since filtfights is also filtered from 2010
filtfights <- filtfights %>%
mutate(fighter1Name = gsub("(.*)(-\\d*$)", "\\1", Link1) %>% gsub("-", "", .) %>% tolower(),
fighter2Name = gsub("(.*)(-\\d*$)", "\\1", Link2) %>% gsub("-", "", .) %>% tolower())
# Begin Matching
filtfightsOdds <- tibble()
for (i in 0:2) {
pastOdds <- pastOdds %>%
mutate(Date2 = Date - i + 1)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter1Name" = "fighterLink1s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds)
filtfightsOdds <- inner_join(filtfights, pastOdds, by = c("fighter2Name" = "fighterLink2s", "Date" = "Date2")) %>%
select(colnames(filtfights), '5Dimes', 'rownum') %>%
rbind(filtfightsOdds) %>%
unique
}
# Fights which are still not matched
filtfightsNotMatched <- anti_join(filtfights, filtfightsOdds, by = "match_id")
pastOddsNotMatched <- anti_join(pastOdds, filtfightsOdds, by = "rownum")
filtfightsOdds <- filtfightsOdds %>%
select(-rownum)
filtfightsOdds <- left_join(filtfightsOdds, filtfightsOdds %>% select(match_id, Link2, `5Dimes`),
by = c("Link1" = "Link2", "match_id" = "match_id")) %>%
as.tibble() %>%
rename(odds5Dimes1 = `5Dimes.x`,
odds5Dimes2 = `5Dimes.y`)
View(filtfightsOdds)
saveRDS(filtfightsOdds, file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds <- readRDS(file = "./scripts/8-append-odds/data/filtfightsOdds.rds")
filtfightsOdds2 <- filtfightsOdds %>%
filter(Result != "draw" & r1b > r2b|
(r1b == r2b & ratIncrease1_3 > ratIncrease2_3)) %>%
mutate(eloWinProb = 1/(1+10^((r2b-r1b)/400)),
Result2 = ifelse(Result == "win", 1, 0))
set.seed(1)
train <- filtfightsOdds2 %>%
sample_n(0.8*nrow(filtfightsOdds2)) %>%
select(-Method, -Method_d, -Event, -Date, -r1a, -r2a, -Fighter1, -Fighter2, -R,
-Time, -Referee, -nc1, -nc2)
test <- anti_join(filtfightsOdds2, train)
model <- glm(Result2 ~ r1b + r2b + wins1 + wins2 + Age1 + Age2 +
oppRat1_5 + oppRat2_5 + koLosses1 + koLosses2,
family = binomial(link="logit"), data = train)
summary(model)
fitted.results <- predict(model,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Result2, na.rm = TRUE)
print(paste('Accuracy',1-misClasificError))
table("predicted" = fitted.results, "actual" = test$Result2)
filtfightsOdds2$pred <- predict(model,newdata=filtfightsOdds2,type='response')
filtfightsOdds2 %>% filter(Date >= "2018-01-01") %>% View()
View(filtfightsOdds2)
filtfightsOdds %>% filter(odds5Dimes1 > 0 & odds5Dimes2 >0)
filtfightsOdds %>% filter(odds5Dimes1 > 0 & odds5Dimes2 >0) %>% View()
-400/100
-100/-400
-100/-400 + 1
View(filtfightsOdds2)
